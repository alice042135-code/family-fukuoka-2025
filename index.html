<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>family-fukuoka-2025</title>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    .sheet-enter-from, .sheet-leave-to {
      transform: translateY(100%);
      opacity: 0;
    }
    .sheet-enter-active, .sheet-leave-active {
      transition: 0.25s;
    }

    html, body { overscroll-behavior: none; }
    .card-shadow { box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
  </style>
</head>

<body class="min-h-screen bg-[#F2F2F2]">
<div id="app" class="w-full max-w-md mx-auto min-h-screen px-3 py-4">

  <!-- æ‰‹æ©Ÿå¤–æ¡† -->
  <div
    class="relative flex flex-col w-full h-[calc(100vh-40px)]
           bg-[#f3f3f3] border border-gray-300 shadow-xl
           rounded-3xl overflow-hidden">

    <!-- header -->
    <div
      class="h-10 flex items-center justify-between px-4
             text-[11px] text-gray-600
             border-b border-gray-200 bg-white">
      <span class="font-semibold tracking-widest text-gray-900">
        FUKUOKA TRIP
      </span>
      <span class="flex items-center gap-1">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
        <span>12/20â€“12/24</span>
      </span>
    </div>

    <!-- Header + æ—¥æœŸåˆ— -->
    <header
      class="px-5 pt-3 pb-2 bg-gradient-to-b from-[#f7f7f7] to-[#efefef]
             shrink-0 z-10 border-b border-gray-200">
      <h1 class="text-lg font-semibold text-gray-900 tracking-tight">
        ç¦å²¡å®¶æ—æ—…éŠè¡Œç¨‹
      </h1>
      <p class="text-xs text-gray-500 mt-1">
        å·¦å³æ»‘å‹•åˆ‡æ›æ—¥æœŸï¼Œé»è¡Œç¨‹å±•é–‹è©³ç´°å‚™è¨»èˆ‡äº®é»ã€‚
      </p>

      <!-- æ—¥æœŸæ»‘å‹• -->
      <div class="mt-3 flex gap-2 overflow-x-auto scrollbar-hide pb-1">
        <button
          v-for="(day, index) in days"
          :key="day.id"
          class="shrink-0 w-32 px-3 py-2 rounded-2xl text-left border
                 transition-all duration-150"
          :class="day.id === selectedDayId
            ? 'bg-[#D5D7E2] text-gray-900 border-gray-900 shadow-md'
            : 'bg-[#E6E6E6] text-gray-700 border-gray-300 hover:border-gray-500'"
          @click="selectDay(day.id)"
        >
          <div class="flex items-center justify-between">
            <span class="text-[12px] uppercase tracking-widest font-semibold text-gray-800">
              Day {{ index + 1 }}
            </span>
            <span
              v-if="dayWeathers[index]"
              class="text-[11px] text-gray-600">
              {{ weatherEmoji(dayWeathers[index].code) }}
            </span>
          </div>
          <div class="text-[12px] mt-0.5 text-gray-800 font-medium">
            {{ day.dateLabel }}
          </div>
          <div v-if="dayWeathers[index]" class="mt-1 text-[11px] text-gray-700">
            <span class="font-semibold text-gray-900">
              {{ Math.round(dayWeathers[index].max) }}Â°
            </span>
            / {{ Math.round(dayWeathers[index].min) }}Â°C
          </div>
          <div v-else class="mt-1 text-[11px] text-gray-500">
            è®€å–ä¸­â€¦
          </div>
        </button>
      </div>
    </header>

    <!-- è¡Œç¨‹åˆ—è¡¨ï¼šä¸­å±¤æ»¾å‹• -->
    <main class="flex-1 overflow-y-auto scrollbar-hide px-4 pt-2 pb-32">

      <!-- è¡Œç¨‹å¡ç‰‡ï¼ˆå¯å±•é–‹ / æ”¶èµ·ï¼‰ -->
      <div
        v-for="(item,index) in sortedItems"
        :key="item.id"
        class="relative mb-2"
        draggable="true"
        @dragstart="onDragStart(index)"
        @dragover.prevent
        @drop.prevent="onDrop(index)"
      >
        <article
          class="relative flex gap-2 px-3 py-2 rounded-2xl bg-white border border-gray-200
                 card-shadow cursor-pointer transition hover:bg-gray-50"
          @click="toggleExpand(item)"
        >
          <!-- å·¦è‰²æ¢ -->
          <div
            class="w-1.5 rounded-full mt-0.5"
            :class="leftStripClass(item)">
          </div>

          <!-- ä¸»å…§å®¹ -->
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between gap-2">
              <div class="text-[12px] font-semibold text-gray-900">
                {{ item.time }}
              </div>
              <span
                class="px-2 py-0.5 rounded-full text-[10px] flex items-center gap-1"
                :class="typePillClass(item)">
                <span>{{ typeIcon(item) }}</span>
                <span>{{ typeLabel(item.type) }}</span>
              </span>
            </div>

            <div class="mt-0.5 text-[13px] text-gray-900 truncate">
              {{ item.title }}
            </div>

            <div
              v-if="item.location"
              class="mt-0.5 text-[11px] text-gray-500 truncate">
              ğŸ“ {{ item.location }}
            </div>

            <!-- æ‘˜è¦å‚™è¨»ï¼Œåªåœ¨æ”¶èµ·ç‹€æ…‹é¡¯ç¤ºä¸€è¡Œ -->
            <div
              v-if="item.note && expandedItemId !== item.id"
              class="mt-0.5 text-[11px] text-gray-600 line-clamp-1">
              å‚™è¨»ï¼š{{ item.note }}
            </div>

            <!-- å±•é–‹å€å¡Š -->
            <div
              v-if="expandedItemId === item.id"
              class="mt-2 border-t border-dashed border-gray-200 pt-2
                     bg-[#F7F7F7] rounded-xl px-2 pb-2">
              <div v-if="item.note" class="mb-1.5">
                <h4 class="text-[11px] font-semibold text-gray-700 mb-0.5">
                  å‚™è¨»
                </h4>
                <p class="text-[11px] text-gray-700 whitespace-pre-line">
                  {{ item.note }}
                </p>
              </div>

              <div
                v-if="item.details && item.details.length"
                class="mb-1.5">
                <h4 class="text-[11px] font-semibold text-gray-700 mb-0.5">
                  äº®é» / å¿…ç©
                </h4>
                <ul class="text-[11px] text-gray-700 list-disc pl-4 space-y-0.5">
                  <li v-for="(d,idx) in item.details" :key="idx">
                    {{ d }}
                  </li>
                </ul>
              </div>

              <div class="mt-1 flex gap-2">
                <button
                  class="flex-1 rounded-xl bg-[#2563EB] text-white text-[11px] py-1.5
                         flex items-center justify-center gap-1
                         hover:bg-[#1D4ED8] transition"
                  @click.stop="openInGoogleMapsForItem(item)">
                  <span>åœ¨ Google Maps é–‹å•Ÿ</span>
                </button>
                <button
                  class="w-20 rounded-xl bg-gray-100 text-gray-800 text-[11px] py-1.5
                         border border-gray-300 hover:bg-gray-200 transition"
                  @click.stop="openSheetForEdit(item)">
                  ç·¨è¼¯
                </button>
              </div>
            </div>
          </div>
        </article>
      </div>

      <!-- æ–°å¢è¡Œç¨‹ -->
      <button
        class="w-full mt-3 py-2.5 text-[11px] rounded-2xl bg-gray-200 text-gray-700
               border border-gray-300 hover:bg-gray-300"
        @click="openSheetForCreate">
        ï¼‹ æ–°å¢è¡Œç¨‹
      </button>
    </main>

    <!-- åœ°åœ–å›ºå®šåœ¨åº•éƒ¨ -->
    <footer
      class="absolute bottom-0 left-0 w-full bg-white
             border-t border-gray-300 p-3 z-20">
      <div class="w-full h-[200px] rounded-xl overflow-hidden border mb-3">
        <iframe
          v-if="currentLocation"
          :src="mapEmbedUrl"
          class="w-full h-full border-0"
          allowfullscreen
          loading="lazy">
        </iframe>
        <div
          v-else
          class="w-full h-full flex items-center justify-center text-[11px] text-gray-500">
          é»é¸è¡Œç¨‹å¾Œï¼Œé€™è£¡æœƒé¡¯ç¤ºå°æ‡‰åœ°é»åœ°åœ–ã€‚
        </div>
      </div>

      <button
        class="w-full py-2.5 rounded-xl text-white font-semibold
               bg-[#8BA6A9] hover:bg-[#7C9699] transition text-[13px]"
        @click="openInGoogleMaps">
        åœ¨ Google Maps é¡¯ç¤ºç›®å‰é¸æ“‡çš„åœ°é»
      </button>
    </footer>

    <!-- è¡Œç¨‹ç·¨è¼¯ bottom sheet -->
    <transition name="sheet">
      <div
        v-if="sheetVisible"
        class="absolute inset-0 bg-black/30 flex items-end z-30"
        @click.self="closeSheet">

        <div
          class="w-full bg-white rounded-t-3xl border-t border-gray-200
                 px-4 pt-3 pb-5 max-h-[80%] overflow-y-auto scrollbar-hide">

          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-semibold text-gray-900">
              {{ isCreating ? 'æ–°å¢è¡Œç¨‹' : 'ç·¨è¼¯è¡Œç¨‹' }}
            </h3>
            <button
              class="text-xs text-gray-500 hover:text-gray-900"
              @click="closeSheet">
              é—œé–‰
            </button>
          </div>

          <form @submit.prevent="saveItem" class="space-y-3">
            <div class="flex gap-3">
              <div class="w-32">
                <label class="block text-[11px] text-gray-500 mb-1">æ™‚é–“</label>
                <input
                  v-model="editingItem.time"
                  type="text"
                  class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                         focus:outline-none focus:ring-1 focus:ring-gray-900"
                  placeholder="ä¾‹å¦‚ 10:00â€“14:00"
                  required />
              </div>
              <div class="flex-1">
                <label class="block text-[11px] text-gray-500 mb-1">è¡Œç¨‹æ¨™é¡Œ</label>
                <input
                  v-model="editingItem.title"
                  type="text"
                  class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                         focus:outline-none focus:ring-1 focus:ring-gray-900"
                  placeholder="ä¾‹å¦‚ æµ·ä¹‹ä¸­é“æµ·æ´‹ä¸–ç•Œ"
                  required />
              </div>
            </div>

            <div>
              <label class="block text-[11px] text-gray-500 mb-1">
                åœ°é»ï¼ˆæœƒç”¨æ–¼åœ°åœ–ï¼† Google Mapsï¼‰
              </label>
              <input
                v-model="editingItem.location"
                type="text"
                class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                       focus:outline-none focus:ring-1 focus:ring-gray-900"
                placeholder="ä¾‹å¦‚ Marine World Uminonakamichi" />
            </div>

            <div class="flex gap-2">
              <div class="flex-1">
                <label class="block text-[11px] text-gray-500 mb-1">é¡å‹</label>
                <select
                  v-model="editingItem.type"
                  class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                         focus:outline-none focus:ring-1 focus:ring-gray-900">
                  <option value="stay">åœç•™</option>
                  <option value="transit">è»Šç¨‹</option>
                  <option value="flight">é£›æ©Ÿ</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-[11px] text-gray-500 mb-1">å‚™è¨»</label>
              <textarea
                v-model="editingItem.note"
                rows="2"
                class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                       focus:outline-none focus:ring-1 focus:ring-gray-900 resize-none"
                placeholder="ä¾‹å¦‚ï¼šæå‰ 10 åˆ†é˜å¡ä½ã€è¨˜å¾—å¸¶å¤–å¥—ç­‰">
              </textarea>
            </div>

            <div>
              <label class="block text-[11px] text-gray-500 mb-1">
                äº®é» / å¿…ç©ï¼ˆæ¯è¡Œä¸€é …ï¼‰
              </label>
              <textarea
                v-model="editingDetailsText"
                rows="3"
                class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                       focus:outline-none focus:ring-1 focus:ring-gray-900 resize-none"
                placeholder="ä¾‹å¦‚ï¼š&#10;10:50 æµ·è±¹ Go Go Seal&#10;11:00 æµ·è±šè¡¨æ¼”">
              </textarea>
            </div>

            <div class="pt-1 flex gap-2">
              <button
                type="submit"
                class="flex-1 rounded-2xl bg-gray-900 text-white text-xs py-2.5
                       hover:bg-black transition">
                å„²å­˜
              </button>
              <button
                v-if="!isCreating"
                type="button"
                class="w-20 rounded-2xl bg-red-50 text-red-600 text-xs py-2.5
                       border border-red-200 hover:bg-red-100 transition"
                @click="deleteItem">
                åˆªé™¤
              </button>
            </div>
          </form>

        </div>
      </div>
    </transition>

  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      days: [],
      selectedDayId: 1,
      selectedItemId: null,

      // å±•é–‹ä¸­çš„è¡Œç¨‹å¡ç‰‡
      expandedItemId: null,

      // ç·¨è¼¯ sheet
      sheetVisible: false,
      isCreating: false,
      editingItem: {
        id: null,
        type: "stay",
        time: "",
        title: "",
        location: "",
        note: "",
        details: []
      },
      editingDetailsText: "",

      // å¤©æ°£
      dayWeathers: [],

      // æ‹–æ›³
      dragSourceIndex: null
    };
  },

  computed: {
    currentDay() {
      return this.days.find(d => d.id === this.selectedDayId) || null;
    },
    sortedItems() {
      if (!this.currentDay) return [];
      return [...this.currentDay.items].sort((a,b) => {
        const at = /^\d/.test(a.time || "") ? a.time : "ZZZ";
        const bt = /^\d/.test(b.time || "") ? b.time : "ZZZ";
        return at.localeCompare(bt);
      });
    },
    currentItem() {
      if (!this.currentDay || !this.selectedItemId) return null;
      return this.currentDay.items.find(i => i.id === this.selectedItemId) || null;
    },
    currentLocation() {
      return this.currentItem && this.currentItem.location
        ? this.currentItem.location
        : "";
    },
    mapEmbedUrl() {
      if (!this.currentLocation) return "";
      const q = encodeURIComponent(this.currentLocation);
      return `https://www.google.com/maps?q=${q}&output=embed`;
    }
  },

  methods: {
    /* ------------ åˆå§‹åŒ–è¡Œç¨‹ï¼ˆä½ æä¾›çš„ Day1â€“5ï¼‰ ------------ */
    initDefaultDays() {
      this.days = [
        {
          id: 1,
          dateLabel: "12/20ï¼ˆäº”ï¼‰",
          items: [
            {
              id: 101,
              type: "flight",
              time: "08:00â€“11:15",
              title: "é•·æ¦® BR106 æŠµé”ç¦å²¡",
              location: "Fukuoka Airport",
              note: "å…¥å¢ƒã€å–è¡Œæ",
              details: []
