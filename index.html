<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>family-fukuoka-2025</title>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    .sheet-enter-from, .sheet-leave-to {
      transform: translateY(100%);
      opacity: 0;
    }
    .sheet-enter-active, .sheet-leave-active {
      transition: 0.25s;
    }

    html, body { overscroll-behavior: none; }
    .card-shadow { box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
  </style>
</head>

<body class="min-h-screen bg-[#F2F2F2]">
<div id="app" class="w-full max-w-md mx-auto min-h-screen px-3 py-4">

  <!-- æ‰‹æ©Ÿå¤–æ¡† -->
  <div
    class="relative flex flex-col w-full h-[calc(100vh-40px)]
           bg-[#f3f3f3] border border-gray-300 shadow-xl
           rounded-3xl overflow-hidden">

    <!-- header -->
    <div
      class="h-10 flex items-center justify-between px-4
             text-[11px] text-gray-600
             border-b border-gray-200 bg-white">
      <span class="font-semibold tracking-widest text-gray-900">
        FUKUOKA TRIP
      </span>
      <span class="flex items-center gap-1">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
        <span>2025/12/20â€“12/24</span>
      </span>
    </div>

    <!-- Header + æ—¥æœŸåˆ— -->
    <header
      class="px-5 pt-3 pb-2 bg-gradient-to-b from-[#f7f7f7] to-[#efefef]
             shrink-0 z-10 border-b border-gray-200">
      <h1 class="text-lg font-semibold text-gray-900 tracking-tight">
        ç¦å²¡å®¶æ—æ—…éŠè¡Œç¨‹
      </h1>
      <p class="text-xs text-gray-500 mt-1">
        å·¦å³æ»‘å‹•åˆ‡æ›æ—¥æœŸï¼Œé»è¡Œç¨‹ï¼Œä¸‹æ–¹æœƒå½ˆå‡ºè©³ç´°è£œå……èªªæ˜ã€‚
      </p>

      <!-- æ—¥æœŸæ»‘å‹• -->
      <div class="mt-3 flex gap-2 overflow-x-auto scrollbar-hide pb-1">
        <button
          v-for="(day, index) in days"
          :key="day.id"
          class="shrink-0 w-32 px-3 py-2 rounded-2xl text-left border
                 transition-all duration-150"
          :class="day.id === selectedDayId
            ? 'bg-[#DCDFF0] text-gray-900 border-gray-900 shadow-md'
            : 'bg-[#E6E6E6] text-gray-700 border-gray-300 hover:border-gray-500'"
          @click="selectDay(day.id)"
        >
          <div class="flex items-center justify-between">
            <span class="text-[12px] uppercase tracking-widest font-semibold text-gray-800">
              Day {{ index + 1 }}
            </span>
            <span
              v-if="dayWeathers[index]"
              class="text-[11px] text-gray-600">
              {{ weatherEmoji(dayWeathers[index].code) }}
            </span>
          </div>
          <div class="text-[12px] mt-0.5 text-gray-800 font-medium">
            {{ day.dateLabel }}
          </div>
          <div v-if="dayWeathers[index]" class="mt-1 text-[11px] text-gray-700">
            <span class="font-semibold text-gray-900">
              {{ Math.round(dayWeathers[index].max) }}Â°
            </span>
            / {{ Math.round(dayWeathers[index].min) }}Â°C
          </div>
          <div v-else class="mt-1 text-[11px] text-gray-500">
            è®€å–ä¸­â€¦
          </div>
        </button>
      </div>
    </header>

    <!-- è¡Œç¨‹åˆ—è¡¨ï¼šä¸­å±¤æ»¾å‹• -->
    <main class="flex-1 overflow-y-auto scrollbar-hide px-4 pt-2 pb-4">

      <!-- è¡Œç¨‹å¡ç‰‡ -->
      <div
        v-for="(item,index) in sortedItems"
        :key="item.id"
        class="relative mb-2"
        draggable="true"
        @dragstart="onDragStart(index)"
        @dragover.prevent
        @drop.prevent="onDrop(index)"
      >
        <article
          class="relative flex gap-2 px-3 py-2 rounded-2xl bg-white border border-gray-200
                 card-shadow cursor-pointer transition hover:bg-gray-50"
          @click="onItemClick(item)"
        >
          <!-- å·¦è‰²æ¢ -->
          <div
            class="w-1.5 rounded-full mt-0.5"
            :class="leftStripClass(item)">
          </div>

          <!-- ä¸»å…§å®¹ -->
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between gap-2">
              <div class="text-[12px] font-semibold text-gray-900">
                {{ item.time }}
              </div>
              <span
                class="px-2 py-0.5 rounded-full text-[10px] flex items-center gap-1"
                :class="typePillClass(item)">
                <span>{{ typeIcon(item) }}</span>
                <span>{{ typeLabel(item.type) }}</span>
              </span>
            </div>

            <div class="mt-0.5 text-[13px] text-gray-900 truncate">
              {{ item.title }}
            </div>

            <div
              v-if="item.location"
              class="mt-0.5 text-[11px] text-gray-500 truncate">
              ğŸ“ {{ item.location }}
            </div>

            <!-- æ‘˜è¦å‚™è¨»ï¼ˆæ”¶èµ·ç‹€æ…‹é¡¯ç¤ºä¸€è¡Œï¼‰ -->
            <div
              v-if="item.note && (!currentItem || currentItem.id !== item.id || !infoPanelVisible)"
              class="mt-0.5 text-[11px] text-gray-600 line-clamp-1">
              å‚™è¨»ï¼š{{ item.note }}
            </div>
          </div>
        </article>
      </div>

      <!-- æ–°å¢è¡Œç¨‹ -->
      <button
        class="w-full mt-3 py-2.5 text-[11px] rounded-2xl bg-gray-200 text-gray-700
               border border-gray-300 hover:bg-gray-300"
        @click="openSheetForCreate">
        ï¼‹ æ–°å¢è¡Œç¨‹
      </button>
    </main>

    <!-- åº•éƒ¨è³‡è¨Šé¢æ¿ï¼šé¡¯ç¤ºå‚™è¨»ï¼‹äº®é»ï¼‹æŒ‰éˆ•ï¼ˆGoogle Maps / ç·¨è¼¯ï¼‰ -->
    <transition name="sheet">
      <div
        v-if="infoPanelVisible && currentItem"
        class="absolute inset-0 bg-black/25 flex items-end z-30"
        @click.self="closeInfoPanel"
      >
        <section
          class="w-full bg-white rounded-t-3xl border-t border-gray-200
                 px-4 pt-3 pb-5 max-h-[60%] overflow-y-auto scrollbar-hide"
        >
          <!-- é¢æ¿é ­ -->
          <div class="flex items-center justify-between mb-2">
            <div>
              <div class="text-[11px] text-gray-500">
                {{ currentDay?.dateLabel }}
              </div>
              <div class="text-[14px] font-semibold text-gray-900 mt-0.5">
                {{ currentItem.time }}
              </div>
              <div class="text-[13px] text-gray-900 mt-0.5">
                {{ currentItem.title }}
              </div>
              <div
                v-if="currentItem.location"
                class="text-[11px] text-gray-600 mt-0.5">
                ğŸ“ {{ currentItem.location }}
              </div>
            </div>

            <button
              class="text-xs text-gray-500 hover:text-gray-900"
              @click="closeInfoPanel">
              æ”¶èµ·
            </button>
          </div>

          <!-- æŒ‰éˆ•åˆ— -->
          <div class="flex gap-2 mt-1 mb-3">
            <button
              class="flex-1 rounded-xl bg-[#3E6F61] text-white text-[11px] py-2.5
                     flex items-center justify-center gap-1
                     hover:bg-[#335B51] transition"
              @click="openInGoogleMaps">
              <span>åœ¨ Google Maps é–‹å•Ÿ</span>
            </button>
            <button
              class="w-24 rounded-xl bg-gray-100 text-gray-800 text-[11px] py-2.5
                     border border-gray-300 hover:bg-gray-200 transition"
              @click="openSheetForEdit(currentItem)">
              ç·¨è¼¯è¡Œç¨‹
            </button>
          </div>

          <!-- å‚™è¨» -->
          <div v-if="currentItem.note" class="mb-3">
            <h4 class="text-[11px] font-semibold text-gray-700 mb-1">
              å‚™è¨»
            </h4>
            <p class="text-[11px] text-gray-700 whitespace-pre-line">
              {{ currentItem.note }}
            </p>
          </div>

          <!-- äº®é» / å¿…ç© -->
          <div
            v-if="currentItem.details && currentItem.details.length"
            class="mb-1">
            <h4 class="text-[11px] font-semibold text-gray-700 mb-1">
              äº®é» / å¿…ç©
            </h4>
            <ul class="text-[11px] text-gray-700 list-disc pl-4 space-y-0.5">
              <li v-for="(d,idx) in currentItem.details" :key="idx">
                {{ d }}
              </li>
            </ul>
          </div>

        </section>
      </div>
    </transition>

    <!-- è¡Œç¨‹ç·¨è¼¯ bottom sheet -->
    <transition name="sheet">
      <div
        v-if="sheetVisible"
        class="absolute inset-0 bg-black/30 flex items-end z-40"
        @click.self="closeSheet">

        <div
          class="w-full bg-white rounded-t-3xl border-t border-gray-200
                 px-4 pt-3 pb-5 max-h-[80%] overflow-y-auto scrollbar-hide">

          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-semibold text-gray-900">
              {{ isCreating ? 'æ–°å¢è¡Œç¨‹' : 'ç·¨è¼¯è¡Œç¨‹' }}
            </h3>
            <button
              class="text-xs text-gray-500 hover:text-gray-900"
              @click="closeSheet">
              é—œé–‰
            </button>
          </div>

          <form @submit.prevent="saveItem" class="space-y-3">
            <div class="flex gap-3">
              <div class="w-32">
                <label class="block text-[11px] text-gray-500 mb-1">æ™‚é–“</label>
                <input
                  v-model="editingItem.time"
                  type="text"
                  class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                         focus:outline-none focus:ring-1 focus:ring-gray-900"
                  placeholder="ä¾‹å¦‚ 10:00â€“14:00"
                  required />
              </div>
              <div class="flex-1">
                <label class="block text-[11px] text-gray-500 mb-1">è¡Œç¨‹æ¨™é¡Œ</label>
                <input
                  v-model="editingItem.title"
                  type="text"
                  class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                         focus:outline-none focus:ring-1 focus:ring-gray-900"
                  placeholder="ä¾‹å¦‚ æµ·ä¹‹ä¸­é“æµ·æ´‹ä¸–ç•Œ"
                  required />
              </div>
            </div>

            <div>
              <label class="block text-[11px] text-gray-500 mb-1">
                åœ°é»ï¼ˆæœƒç”¨æ–¼ Google Mapsï¼‰
              </label>
              <input
                v-model="editingItem.location"
                type="text"
                class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                       focus:outline-none focus:ring-1 focus:ring-gray-900"
                placeholder="ä¾‹å¦‚ Marine World Uminonakamichi" />
            </div>

            <div class="flex gap-2">
              <div class="flex-1">
                <label class="block text-[11px] text-gray-500 mb-1">é¡å‹</label>
                <select
                  v-model="editingItem.type"
                  class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                         focus:outline-none focus:ring-1 focus:ring-gray-900">
                  <option value="stay">åœç•™</option>
                  <option value="transit">è»Šç¨‹</option>
                  <option value="flight">é£›æ©Ÿ</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-[11px] text-gray-500 mb-1">å‚™è¨»</label>
              <textarea
                v-model="editingItem.note"
                rows="2"
                class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                       focus:outline-none focus:ring-1 focus:ring-gray-900 resize-none"
                placeholder="ä¾‹å¦‚ï¼šæå‰ 10 åˆ†é˜å¡ä½ã€è¨˜å¾—å¸¶å¤–å¥—ç­‰">
              </textarea>
            </div>

            <div>
              <label class="block text-[11px] text-gray-500 mb-1">
                äº®é» / å¿…ç©ï¼ˆæ¯è¡Œä¸€é …ï¼‰
              </label>
              <textarea
                v-model="editingDetailsText"
                rows="3"
                class="w-full rounded-xl border border-gray-300 text-xs px-2 py-1.5
                       focus:outline-none focus:ring-1 focus:ring-gray-900 resize-none"
                placeholder="ä¾‹å¦‚ï¼š&#10;10:50 æµ·è±¹ Go Go Seal&#10;11:00 æµ·è±šè¡¨æ¼”">
              </textarea>
            </div>

            <div class="pt-1 flex gap-2">
              <button
                type="submit"
                class="flex-1 rounded-2xl bg-gray-900 text-white text-xs py-2.5
                       hover:bg-black transition">
                å„²å­˜
              </button>
              <button
                v-if="!isCreating"
                type="button"
                class="w-20 rounded-2xl bg-red-50 text-red-600 text-xs py-2.5
                       border border-red-200 hover:bg-red-100 transition"
                @click="deleteItem">
                åˆªé™¤
              </button>
            </div>
          </form>

        </div>
      </div>
    </transition>

  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      days: [],
      selectedDayId: 1,
      selectedItemId: null,

      // ä¸‹æ–¹è³‡è¨Šé¢æ¿
      infoPanelVisible: false,

      // ç·¨è¼¯ bottom sheet
      sheetVisible: false,
      isCreating: false,
      editingItem: {
        id: null,
        type: "stay",
        time: "",
        title: "",
        location: "",
        note: "",
        details: []
      },
      editingDetailsText: "",

      // å¤©æ°£
      dayWeathers: [],

      // æ‹–æ›³
      dragSourceIndex: null
    };
  },

  computed: {
    currentDay() {
      return this.days.find(d => d.id === this.selectedDayId) || null;
    },
    sortedItems() {
      if (!this.currentDay) return [];
      return [...this.currentDay.items].sort((a,b) => {
        const at = /^\d/.test(a.time || "") ? a.time : "ZZZ";
        const bt = /^\d/.test(b.time || "") ? b.time : "ZZZ";
        return at.localeCompare(bt);
      });
    },
    currentItem() {
      if (!this.currentDay || !this.selectedItemId) return null;
      return this.currentDay.items.find(i => i.id === this.selectedItemId) || null;
    },
    currentLocation() {
      return this.currentItem && this.currentItem.location
        ? this.currentItem.location
        : "";
    }
  },

  methods: {
    /* ------------ åˆå§‹åŒ–è¡Œç¨‹ï¼ˆ2025/12/20â€“12/24ï¼‰ ------------ */
    initDefaultDays() {
      this.days = [
        {
          id: 1,
          dateLabel: "12/20ï¼ˆå…­ï¼‰",
          items: [
            {
              id: 101,
              type: "flight",
              time: "08:00â€“11:15",
              title: "é•·æ¦® BR106 æŠµé”ç¦å²¡",
              location: "Fukuoka Airport",
              note: "å…¥å¢ƒã€å–è¡Œæ",
              details: []
            },
            {
              id: 102,
              type: "stay",
              time: "12:00â€“13:30",
              title: "åšå¤šç”ºå±‹ãƒ»æ«›ç”°ç¥ç¤¾",
              location: "Kushida Shrine",
              details: ["åƒè§€è€è¡—", "ç¥‡åœ’å±±ç¬ æ­·å²é¤¨"]
            },
            {
              id: 103,
              type: "transit",
              time: "13:40â€“14:00",
              title: "æ«›ç”°ç¥ç¤¾ â†’ Blossom Hotel",
              location: "Kushida Shrine â†’ JR Kyushu Blossom Hotel"
            },
            {
              id: 104,
              type: "stay",
              time: "14:00â€“16:30",
              title: "JR ä¹å· Blossom é£¯åº— Check-in",
              location: "JR Kyushu Hotel Blossom Hakata Central",
              details: ["å¯„æ”¾è¡Œæ", "é™„è¿‘é¤å»³æ–¹ä¾¿è¦“é£Ÿ"]
            },
            {
              id: 105,
              type: "stay",
              time: "16:30â€“20:00",
              title: "åšå¤šé‹æ²³åŸ",
              location: "Canal City Hakata",
              details: ["è‡ªç”±æ´»å‹•"]
            }
          ]
        },
        {
          id: 2,
          dateLabel: "12/21ï¼ˆæ—¥ï¼‰",
          items: [
            {
              id: 201,
              type: "transit",
              time: "09:30â€“10:00",
              title: "å‰å¾€æµ·ä¹‹ä¸­é“æµ·æ´‹ä¸–ç•Œ",
              location: "Hakata Station â†’ Marine World Uminonakamichi"
            },
            {
              id: 202,
              type: "stay",
              time: "10:00â€“14:00",
              title: "æµ·ä¹‹ä¸­é“æµ·æ´‹ä¸–ç•Œ Marine World",
              location: "Marine World Uminonakamichi",
              note: "æå‰ 10 åˆ†é˜å¡ä½ã€å‹•ç·šç·Šå¯†",
              details: [
                "10:50 æµ·è±¹ Go Go Seal",
                "11:00 æµ·è±šè¡¨æ¼”",
                "12:45 ä¼éµéŠè¡Œ",
                "12:00â€“13:00 Reilly æµ·æ™¯é¤å»³åˆé¤"
              ]
            },
            {
              id: 203,
              type: "transit",
              time: "14:00â€“14:30",
              title: "æµ·æ´‹ä¸–ç•Œ â†’ å¤©ç¥ Parco",
              location: "Marine World â†’ Tenjin Parco"
            },
            {
              id: 204,
              type: "stay",
              time: "14:30â€“20:00",
              title: "å¤©ç¥è¡—å€è‡ªç”±æ´»å‹•",
              location: "Tenjin Area",
              details: ["è³¼ç‰©", "è—¥å¦", "ç¾å¦", "å’–å•¡ä¼‘æ¯"]
            },
            {
              id: 205,
              type: "transit",
              time: "20:00â€“20:30",
              title: "å¤©ç¥ â†’ Blossom é£¯åº—",
              location: "Tenjin â†’ JR Kyushu Blossom Hotel"
            }
          ]
        },
        {
          id: 3,
          dateLabel: "12/22ï¼ˆä¸€ï¼‰",
          items: [
            {
              id: 301,
              type: "stay",
              time: "08:00â€“08:30",
              title: "é£¯åº— Check-out",
              location: "JR Kyushu Blossom Hotel"
            },
            {
              id: 302,
              type: "transit",
              time: "08:30â€“10:30",
              title: "åšå¤š â†’ ä¹å·è‡ªç„¶å‹•ç‰©åœ’",
              location: "Hakata â†’ African Safari",
              note: "è»Šç¨‹ç´„ 2 å°æ™‚"
            },
            {
              id: 303,
              type: "stay",
              time: "10:30â€“13:30",
              title: "ä¹å·è‡ªç„¶å‹•ç‰©åœ’ï¼ˆAfrican Safariï¼‰",
              location: "African Safari",
              details: [
                "11:00 å¢æ—å·´å£«ï¼ˆ50 åˆ†ï¼‰",
                "12:00â€“13:00 åœ’å…§é¤å»³åˆé¤",
                "å‹•ç‰©åœ’æ•£æ­¥æ‹ç…§ã€è¦ªå­é«”é©—"
              ]
            },
            {
              id: 304,
              type: "transit",
              time: "13:30â€“14:00",
              title: "å‹•ç‰©åœ’ â†’ æ¹¯å¸ƒé™¢æ˜­å’Œé¤¨",
              location: "African Safari â†’ Yufuin Showa Museum"
            },
            {
              id: 305,
              type: "stay",
              time: "14:00â€“17:30",
              title: "æ¹¯ã®åªè¡—é“æ•£ç­–ï¼ˆæ¹¯å¸ƒé™¢ï¼‰",
              location: "Yunotsubo Kaido, Yufuin",
              details: ["èŠ±å‰æ‘", "æ¹¯ã®åªæ©«ä¸", "Snoopy ä¸»é¡Œå•†åº—"]
            },
            {
              id: 306,
              type: "transit",
              time: "17:30â€“18:00",
              title: "æ¹¯å¸ƒé™¢ â†’ åˆ¥åºœ",
              location: "Yufuin â†’ Beppu"
            },
            {
              id: 307,
              type: "stay",
              time: "18:00â€“21:00",
              title: "Check-in è¥¿éµ Resort Inn åˆ¥åºœ",
              location: "Nishitetsu Resort Inn Beppu",
              details: ["é£¯åº—å‘¨é‚Šè‡ªç”±æ´»å‹•", "ç”¨é¤"]
            }
          ]
        },
        {
          id: 4,
          dateLabel: "12/23ï¼ˆäºŒï¼‰",
          items: [
            {
              id: 401,
              type: "stay",
              time: "10:00â€“10:10",
              title: "è¥¿éµ Resort Inn åˆ¥åºœ Check-out",
              location: "Nishitetsu Resort Inn Beppu"
            },
            {
              id: 402,
              type: "transit",
              time: "10:10â€“12:10",
              title: "åˆ¥åºœ â†’ å¤ªå®°åºœå¤©æ»¿å®®",
              location: "Beppu â†’ Dazaifu Tenmangu"
            },
            {
              id: 403,
              type: "stay",
              time: "12:10â€“13:30",
              title: "å¤ªå®°åºœå¤©æ»¿å®® + åƒé“å•†åº—è¡—",
              location: "Dazaifu Tenmangu",
              details: ["æ¢…æé¤…", "å¾¡å®ˆ", "å¯æ„›å°åº—"]
            },
            {
              id: 404,
              type: "stay",
              time: "13:30â€“14:30",
              title: "å¤ªå®°åºœå‘¨é‚Šåˆé¤",
              location: "Dazaifu restaurants"
            },
            {
              id: 405,
              type: "stay",
              time: "14:30â€“16:30",
              title: "ä¹å·åœ‹ç«‹åšç‰©é¤¨ï¼ˆæˆ–å¸‚å€è‡ªç”±æ´»å‹•ï¼‰",
              location: "Kyushu National Museum"
            },
            {
              id: 406,
              type: "transit",
              time: "17:00â€“18:00",
              title: "å¤ªå®°åºœ â†’ ç¦å²¡å¤©ç¥æ˜†ç‰¹è–©é…’åº—",
              location: "Dazaifu â†’ Quintessa Hotel Fukuoka Tenjin"
            },
            {
              id: 407,
              type: "stay",
              time: "18:00â€“19:00",
              title: "Check-in + æ•´ç†ä¼‘æ¯",
              location: "Quintessa Hotel Fukuoka Tenjin"
            },
            {
              id: 408,
              type: "stay",
              time: "19:00â€“21:00",
              title: "ç¦å²¡å¡”",
              location: "Fukuoka Tower",
              details: ["å¤•é™½", "å¤œæ™¯", "å¡”ä¸‹æµ·æ¿±æ•£æ­¥"]
            }
          ]
        },
        {
          id: 5,
          dateLabel: "12/24ï¼ˆä¸‰ï¼‰",
          items: [
            {
              id: 501,
              type: "stay",
              time: "11:00â€“11:10",
              title: "ç¦å²¡å¤©ç¥æ˜†ç‰¹è–©é…’åº— Check-out",
              location: "Quintessa Hotel Fukuoka Tenjin"
            },
            {
              id: 502,
              type: "transit",
              time: "11:10â€“11:20",
              title: "é£¯åº— â†’ éºµåŒ…è¶…äººåšç‰©é¤¨",
              location: "Quintessa Hotel â†’ Anpanman Children's Museum Fukuoka"
            },
            {
              id: 503,
              type: "stay",
              time: "11:20â€“12:30",
              title: "éºµåŒ…è¶…äººåšç‰©é¤¨",
              location: "Anpanman Children's Museum Fukuoka",
              details: ["å®¤å…§éŠå…·", "æ‹ç…§é»", "å‘¨é‚Šå•†å“"]
            },
            {
              id: 504,
              type: "transit",
              time: "12:30â€“12:50",
              title: "éºµåŒ…è¶…äºº â†’ åšå¤šé˜ªæ€¥",
              location: "Anpanman Museum â†’ Hakata Hankyu"
            },
            {
              id: 505,
              type: "stay",
              time: "12:50â€“17:30",
              title: "åšå¤šé˜ªæ€¥ï¼ˆåˆé¤ + è³¼ç‰©ï¼‰",
              location: "Hakata Hankyu",
              details: ["Dacomecca", "ç™¾è²¨ç¾é£Ÿæ¨“", "æœ€å¾Œæ¡è²·"]
            },
            {
              id: 506,
              type: "transit",
              time: "17:30â€“18:00",
              title: "åšå¤šé˜ªæ€¥ â†’ ç¦å²¡æ©Ÿå ´",
              location: "Hakata Hankyu â†’ Fukuoka Airport"
            },
            {
              id: 507,
              type: "stay",
              time: "18:00â€“20:55",
              title: "ç¦å²¡æ©Ÿå ´ï¼ˆæ‰˜é‹ã€å…ç¨…åº—ã€ä¼‘æ¯ï¼‰",
              location: "Fukuoka Airport"
            },
            {
              id: 508,
              type: "flight",
              time: "20:55â€“22:40",
              title: "é•·æ¦® BR101 å›ç¨‹",
              location: "Fukuoka Airport"
            }
          ]
        }
      ];
    },

    /* ------------ localStorage ------------ */
    loadFromStorage() {
      try {
        const raw = localStorage.getItem("fukuokaTripApp_vInfoPanel_v2");
        if (raw) {
          const data = JSON.parse(raw);
          if (Array.isArray(data.days) && data.days.length > 0) {
            this.days = data.days;
            this.selectedDayId = data.selectedDayId || 1;
            this.selectedItemId = data.selectedItemId || null;
            return;
          }
        }
      } catch (e) {
        console.warn("è®€å– localStorage å¤±æ•—ï¼Œæ”¹ç”¨é è¨­è¡Œç¨‹", e);
      }
      this.initDefaultDays();
    },
    saveToStorage() {
      const payload = {
        days: this.days,
        selectedDayId: this.selectedDayId,
        selectedItemId: this.selectedItemId
      };
      localStorage.setItem("fukuokaTripApp_vInfoPanel_v2", JSON.stringify(payload));
    },

    /* ------------ UI æ“ä½œ ------------ */
    selectDay(id) {
      this.selectedDayId = id;
      const first = this.currentDay?.items[0];
      this.selectedItemId = first ? first.id : null;
      this.infoPanelVisible = false;
    },

    onItemClick(item) {
      this.selectedItemId = item.id;
      this.infoPanelVisible = true;
    },

    closeInfoPanel() {
      this.infoPanelVisible = false;
    },

    openSheetForCreate() {
      this.isCreating = true;
      this.sheetVisible = true;
      this.editingItem = {
        id: null,
        type: "stay",
        time: "",
        title: "",
        location: "",
        note: "",
        details: []
      };
      this.editingDetailsText = "";
    },

    openSheetForEdit(item) {
      this.isCreating = false;
      this.sheetVisible = true;
      this.editingItem = JSON.parse(JSON.stringify(item));
      this.editingDetailsText = (item.details || []).join("\n");
    },

    closeSheet() {
      this.sheetVisible = false;
    },

    saveItem() {
      if (!this.currentDay) return;

      const details = this.editingDetailsText
        .split("\n")
        .map(s => s.trim())
        .filter(s => s.length > 0);
      this.editingItem.details = details;

      if (this.isCreating) {
        const allIds = this.days.flatMap(d => d.items.map(i => i.id));
        const newId = allIds.length ? Math.max(...allIds) + 1 : 1;
        this.editingItem.id = newId;
        this.currentDay.items.push(JSON.parse(JSON.stringify(this.editingItem)));
        this.selectedItemId = newId;
      } else {
        const idx = this.currentDay.items.findIndex(i => i.id === this.editingItem.id);
        if (idx !== -1) {
          this.currentDay.items[idx] = JSON.parse(JSON.stringify(this.editingItem));
          this.selectedItemId = this.editingItem.id;
        }
      }

      this.sheetVisible = false;
      this.saveToStorage();
    },

    deleteItem() {
      if (!this.currentDay || this.isCreating) return;
      if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ")) return;

      const delId = this.editingItem.id;
      this.currentDay.items = this.currentDay.items.filter(i => i.id !== delId);

      if (this.selectedItemId === delId) {
        this.selectedItemId = this.currentDay.items[0]?.id || null;
      }

      this.sheetVisible = false;
      this.infoPanelVisible = false;
      this.saveToStorage();
    },

    /* ------------ Google Maps ------------ */
    openInGoogleMaps() {
      if (!this.currentLocation) return;
      const q = encodeURIComponent(this.currentLocation);
      window.open(`https://www.google.com/maps/search/?api=1&query=${q}`, "_blank");
    },

    /* ------------ é¡å‹é¡¯ç¤º & è‰²å½©ï¼ˆæ›´é®®æ˜è«è˜­è¿ªï¼‰ ------------ */
    typeLabel(type) {
      if (type === "flight") return "é£›æ©Ÿ";
      if (type === "transit") return "è»Šç¨‹";
      return "åœç•™";
    },
    typeIcon(item) {
      if (item.type === "flight") return "âœˆï¸";
      if (item.type === "transit") return "ğŸš—";
      return "ğŸ“";
    },
    leftStripClass(item) {
      if (item.type === "flight") return "bg-[#D6C4F0]";       // æ·¡ç´«
      if (item.type === "transit") return "bg-[#BDDCD1]";     // ç¶ è—
      return "bg-[#C6D6EB]";                                   // è—ç°
    },
    typePillClass(item) {
      if (item.type === "flight") {
        return "bg-[#EFE7F8] text-[#6B46A3]";
      } else if (item.type === "transit") {
        return "bg-[#E6F3EF] text-[#3E6F61]";
      } else {
        return "bg-[#E7EFF8] text-[#375A7F]";
      }
    },

    /* ------------ å¤©æ°£ï¼ˆæ¯æ¬¡é–‹å•Ÿéƒ½æŠ“ã€Œæœ€æ–°é å ±ã€ï¼‰ ------------ */
    weatherEmoji(code) {
      if (code === 0) return "â˜€ï¸";
      if ([1,2,3].includes(code)) return "â›…ï¸";
      if ([51,53,55,61,63,65,80,81,82].includes(code)) return "ğŸŒ§";
      if ([71,73,75,85,86].includes(code)) return "â„ï¸";
      if ([95,96,99].includes(code)) return "â›ˆ";
      return "ğŸŒ¤";
    },
    async fetchWeather() {
      try {
        const url =
          "https://api.open-meteo.com/v1/forecast" +
          "?latitude=33.5902&longitude=130.4017" +
          "&timezone=Asia%2FTokyo" +
          "&daily=temperature_2m_max,temperature_2m_min,weathercode";

        const res = await fetch(url);
        const data = await res.json();
        const d = data.daily;
        this.dayWeathers = d.time.map((_, idx) => ({
          max: d.temperature_2m_max[idx],
          min: d.temperature_2m_min[idx],
          code: d.weathercode[idx]
        }));
      } catch (e) {
        console.warn("å¤©æ°£è®€å–å¤±æ•—", e);
      }
    },

    /* ------------ æ‹–æ›³æ’åº ------------ */
    onDragStart(index) {
      this.dragSourceIndex = index;
    },
    onDrop(targetIndex) {
      if (this.dragSourceIndex === null || !this.currentDay) return;
      if (targetIndex === this.dragSourceIndex) return;

      const list = this.currentDay.items;
      const moved = list.splice(this.dragSourceIndex, 1)[0];
      list.splice(targetIndex, 0, moved);
      this.dragSourceIndex = null;
      this.saveToStorage();
    }
  },

  mounted() {
    this.loadFromStorage();
    if (this.currentDay && this.currentDay.items.length) {
      this.selectedItemId = this.currentDay.items[0].id;
    }
    this.fetchWeather();
  },

  watch: {
    days: {
      deep: true,
      handler() {
        this.saveToStorage();
      }
    },
    selectedDayId() {
      this.saveToStorage();
    },
    selectedItemId() {
      this.saveToStorage();
    }
  }
}).mount("#app");
</script>

</body>
</html>
