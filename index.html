<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>family-fukuoka-2025</title>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    .sheet-enter-from, .sheet-leave-to {
      transform: translateY(100%);
      opacity: 0;
    }
    .sheet-enter-active, .sheet-leave-active {
      transition: 0.25s;
    }

    html, body { overscroll-behavior: none; }
    .card-shadow { box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
  </style>
</head>

<body class="bg-[#F2F2F2] min-h-screen">
<div id="app" class="w-full max-w-md mx-auto min-h-screen px-3 py-4">

  <div class="relative flex flex-col w-full h-[calc(100vh-40px)]
              bg-[#f8f8f8] border border-gray-300 shadow-xl
              rounded-3xl overflow-hidden">

    <div class="h-10 flex items-center justify-between px-4
                text-[11px] text-gray-600
                border-b border-gray-200 bg-white">
      <span class="font-semibold tracking-widest text-gray-900">
        FUKUOKA TRIP
      </span>
      <span class="flex items-center gap-1">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
        <span>2025/12/20–12/24</span>
      </span>
    </div>

    <header class="px-5 pt-3 pb-2 bg-gradient-to-b from-[#f7f7f7] to-[#efefef]
                   shrink-0 z-10 border-b border-gray-200">
      <h1 class="text-lg font-semibold text-gray-900 tracking-tight">
        福岡家族旅遊行程
      </h1>
      <p class="text-xs text-gray-500 mt-1">
        左右滑動切換日期，點行程，下方會彈出詳細補充說明。
      </p>

      <div class="mt-3 flex gap-2 overflow-x-auto scrollbar-hide pb-1">
        <button
          v-for="(day, index) in days"
          :key="day.id"
          class="shrink-0 w-32 px-3 py-2 rounded-2xl text-left border
                 transition-all duration-150"
          :class="day.id === selectedDayId
            ? 'bg-[#DCDFF0] text-gray-900 border-gray-900 shadow-md'
            : 'bg-[#E6E6E6] text-gray-700 border-gray-300 hover:border-gray-500'"
          @click="selectDay(day.id)"
        >
          <div class="flex items-center justify-between">
            <span class="text-[12px] uppercase tracking-widest font-semibold text-gray-800">
              Day {{ index + 1 }}
            </span>
            <span v-if="dayWeathers[index]" class="text-[11px] text-gray-600">
              {{ weatherEmoji(dayWeathers[index].code) }}
            </span>
          </div>
          <div class="text-[12px] mt-0.5 text-gray-800 font-medium">
            {{ day.dateLabel }}
          </div>
          <div v-if="dayWeathers[index]" class="mt-1 text-[11px] text-gray-700">
            <span class="font-semibold text-gray-900">
              {{ Math.round(dayWeathers[index].max) }}°
            </span>
            / {{ Math.round(dayWeathers[index].min) }}°C
          </div>
          <div v-else class="mt-1 text-[11px] text-gray-500">
            讀取中…
          </div>
        </button>
      </div>
    </header>

    <!-- ====================== -->
    <!-- 行程列表（可捲動） -->
    <!-- ====================== -->
    <main class="flex-1 overflow-y-auto scrollbar-hide px-4 py-3">

      <div
        v-for="evt in filteredEvents"
        :key="evt.id"
        class="relative flex items-start gap-3 bg-white
               rounded-xl border border-gray-100 card-shadow
               mb-3 active:scale-[0.98] cursor-pointer"
        :class="evt.type === 'transit'
          ? 'p-2'
          : 'p-3'"
        @click="openSheet(evt)"
      >
        <!-- ICON（左側） -->
        <div class="text-[18px] flex items-center"
             :style="{ color: iconColor(evt.type) }">
          {{ typeIcon(evt.type) }}
        </div>

        <!-- 左色條 -->
        <div class="w-2 rounded-lg mt-1"
             :style="{ backgroundColor: typeColor(evt.type) }"
             style="margin-left: 8px;">
        </div>

        <!-- 右側內容 -->
        <div class="flex-1">
          <div class="flex items-center justify-between">
            <div
              class="font-semibold text-gray-900 tracking-tight"
              :class="evt.type === 'transit' ? 'text-[14px]' : 'text-[15px]'"
            >
              {{ evt.time }}
            </div>

            <span
              class="text-[11px] px-2 py-0.5 rounded-lg font-medium"
              :style="{
                backgroundColor: tagBgColor(evt.type),
                color: tagTextColor(evt.type)
              }"
            >
              {{ typeLabel(evt.type) }}
            </span>
          </div>

          <div
            class="mt-1 text-gray-800 font-medium"
            :class="evt.type === 'transit' ? 'text-[13px]' : 'text-[14px]'"
          >
            {{ evt.title }}
          </div>
        </div>
      </div>

      <button
        class="w-full bg-white border border-gray-300
               text-gray-700 rounded-xl py-3 mt-4 text-[14px]
               font-medium shadow-sm active:scale-[0.98]"
        @click="createNewEvent"
      >
        ＋ 新增行程
      </button>

    </main>

    <!-- ============================== -->
    <!--        Info Sheet             -->
    <!-- ============================== -->
    <transition name="sheet">
      <div v-if="activeEvent"
        class="absolute bottom-0 left-0 right-0
               bg-white rounded-t-3xl shadow-xl
               border-t border-gray-200 p-5 z-40"
        style="height: 45%;">

        <div class="flex items-center gap-3 mb-4">
          <a
            :href="googleMapsUrl(activeEvent)"
            target="_blank"
            class="flex-1 text-center py-2 rounded-xl text-white
                   font-semibold text-[14px] shadow-sm active:scale-[0.98]"
            style="background-color: #3E6F61;">
            在 Google Maps 開啟
          </a>

          <button
            @click.stop="openEdit(activeEvent)"
            class="w-24 text-center py-2 rounded-xl border
                   border-gray-300 bg-gray-100 text-gray-700
                   font-semibold text-[14px] active:scale-[0.98]"
          >
            編輯
          </button>
        </div>

        <div class="overflow-y-auto pr-1 h-[calc(100%-70px)]
                    text-[14px] leading-relaxed scrollbar-hide">
          <div v-if="activeEvent.note" class="mb-4">
            <div class="text-[13px] font-semibold text-gray-800 mb-1">備註 Notes</div>
            <div class="whitespace-pre-line text-gray-700">
              {{ activeEvent.note }}
            </div>
          </div>

          <div v-if="activeEvent.highlights?.length" class="mb-3">
            <div class="text-[13px] font-semibold text-gray-800 mb-1">亮點 Highlights</div>
            <ul class="list-disc pl-5 text-gray-700">
              <li v-for="(hl, idx) in activeEvent.highlights" :key="idx">
                {{ hl }}
              </li>
            </ul>
          </div>

          <div
            v-if="!activeEvent.note && (!activeEvent.highlights || !activeEvent.highlights.length)"
            class="text-gray-500 text-[13px]">
            無補充說明
          </div>
        </div>
      </div>
    </transition>

    <!-- ============================== -->
    <!--        Edit Sheet             -->
    <!-- ============================== -->
    <transition name="sheet">
      <div v-if="editingEvent"
        class="absolute bottom-0 left-0 right-0
               bg-white rounded-t-3xl shadow-xl border-t border-gray-200
               p-5 z-50"
        style="height: 60%;">

        <h2 class="text-[16px] font-semibold text-gray-900 mb-4">
          編輯行程
        </h2>

        <div class="flex flex-col gap-3 h-[calc(100%-40px)]
                    overflow-y-auto pr-2">

          <div>
            <label class="text-[13px] font-semibold text-gray-700">時間</label>
            <input type="text" v-model="editingEvent.time"
              class="w-full mt-1 px-3 py-2 rounded-xl border
                     border-gray-300 text-[14px]">
          </div>

          <div>
            <label class="text-[13px] font-semibold text-gray-700">標題</label>
            <input type="text" v-model="editingEvent.title"
              class="w-full mt-1 px-3 py-2 rounded-xl border
                     border-gray-300 text-[14px]">
